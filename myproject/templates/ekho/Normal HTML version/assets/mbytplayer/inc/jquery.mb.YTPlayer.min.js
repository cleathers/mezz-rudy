/*******************************************************************************
 jquery.mb.components
 Copyright (c) 2001-2010. Matteo Bicocchi (Pupunzi); Open lab srl, Firenze - Italy
 email: mbicocchi@open-lab.com
 site: http://pupunzi.com

 Licences: MIT, GPL
 http://www.opensource.org/licenses/mit-license.php
 http://www.gnu.org/licenses/gpl.html
 ******************************************************************************/
function onYouTubePlayerReady(a){var b=jQuery("#"+a);b.mb_setMovie();jQuery(document).on("mousedown",function(a){if(a.target.tagName.toLowerCase()=="a")b.pauseYTP()})}function playerState(a,b){var c=jQuery("#"+b).get(0);var d=jQuery("#"+c.id+"_data").data();if(a==0&&d.isBgndMovie){jQuery(document).trigger("YTPEnd");if(d.loop)c.playVideo();else jQuery(c).stopYTP()}if(a==0&&!d.isBgndMovie){jQuery(document).trigger("YTPEnd");jQuery(c).stopYTP()}if(a==-1||a==3){jQuery(document).trigger("YTPBuffering");jQuery(".mbYTP_bufferImg").show()}if(a==1&&d.isBgndMovie){jQuery(c).css({opacity:d.opacity});jQuery(".mbYTP_raster").css({opacity:1,backgroundColor:"transparent"});jQuery("#wrapper_"+c.id).animate({opacity:1},1e3);jQuery(document).trigger("YTPStart");jQuery(".mbYTP_bufferImg").hide()}if(a==1&&!d.isBgndMovie){jQuery(c).css({opacity:d.opacity});c.totalBytes=c.getVideoBytesTotal();jQuery(document).trigger("YTPStart");jQuery(".mbYTP_bufferImg").hide()}if(a==2)jQuery(document).trigger("YTPPause")}(function(a){a.mbYTPlayer={name:"$.mb.YTPlayer",version:"1.4.0",author:"Matteo Bicocchi",width:450,controls:{play:"<img src='images/play.png'>",pause:"<img src='images/pause.png'>",mute:"<img src='images/mute.png'>",unmute:"<img src='images/unmute.png'>"},rasterImg:"images/raster.png",setYTPlayer:function(){var b=this;a.getScript("http://ajax.googleapis.com/ajax/libs/swfobject/2/swfobject.js",function(){b.each(function(){var b=a(this);if(!b.is("a"))return;if(!b.attr("id"))b.attr("id","YTP_"+(new Date).getTime());var c=b.attr("id");var d=a("<span/>");d.attr("id",c+"_data").hide();var e=d.data();e.opacity=1;e.isBgndMovie=false;e.width=a.mbYTPlayer.width;e.quality="default";e.muteSound=false;e.hasControls=false;e.ratio="16/9";e.bufferImg=false;e.autoplay=true;var f=typeof document.YTPBG!="undefined";if(a.metadata){a.metadata.setType("class");if(b.metadata().quality)e.quality=b.metadata().quality;if(b.metadata().width)e.width=b.metadata().width;if(b.metadata().opacity)e.opacity=a.browser.msie?1:b.metadata().opacity?b.metadata().opacity:e.opacity;if(b.metadata().isBgndMovie&&!f){e.isBgndMovie=b.metadata().isBgndMovie;e.width=b.metadata().isBgndMovie.width?b.metadata().isBgndMovie.width:"window"}if(b.metadata().optimizeDisplay&&e.isBgndMovie){e.optimizeDisplay=b.metadata().optimizeDisplay}if(b.metadata().muteSound){e.muteSound=b.metadata().muteSound}if(b.metadata().loop){e.loop=b.metadata().loop}if(b.metadata().hasControls){e.hasControls=b.metadata().hasControls}if(b.metadata().ratio){e.ratio=b.metadata().ratio}if(b.metadata().bufferImg){e.bufferImg=b.metadata().bufferImg}if(b.metadata().ID){e.ID=b.metadata().ID}if(b.metadata().autoplay!=undefined){e.autoplay=b.metadata().autoplay}if(b.metadata().showControls!=undefined){e.showControls=b.metadata().showControls}if(b.metadata().addRaster!=undefined){e.addRaster=b.metadata().addRaster}else{e.addRaster=false}if(b.metadata().lightCrop!=undefined){e.lightCrop=b.metadata().lightCrop}else{e.lightCrop=false}}var g=e.ID?a("#"+e.ID):a("body");if(e.ID){g.css({overflow:"hidden"})}if(e.width=="window"){e.height="100%";e.width="100%"}else e.height=e.ratio=="16/9"?Math.ceil(9*e.width/16):Math.ceil(3*e.width/4);var h="";a(g).prepend(d);if(e.isBgndMovie){if(e.ID){var i=a("<div/>").css({position:"relative",zIndex:0});var j=g.css("position")=="static"?"relative":g.css("position");g.css("position",j);a(g).wrapInner(i);a(g).prepend(b)}else{a(g).css({position:"relative",zIndex:1});a(g).before(b)}var k=e.ID?"absolute":"fixed";h=a("<div/>").attr("id","wrapper_"+c).css({overflow:"hidden",position:k,left:0,top:0,width:"100%",height:"100%",opacity:0});b.wrap(h);if(!e.width.toString().indexOf("%")==-1){var l=a("<div/>").css({position:k,top:e.ratio=="4/3"&&!e.ID?-(e.height/4):0,left:0,display:"block",width:e.width,height:e.height});b.wrap(l)}}else{h=a("<span/>").attr("id","wrapper_"+c).css({width:e.width,height:e.height,position:"relative",opacity:0}).addClass("mb_YTVPlayer");b.wrap(h)}if(e.optimizeDisplay){a(window).resize(function(){a(b).optimizeDisplay()});a(document).on("YTPStart",function(){a(b).optimizeDisplay();setTimeout(function(){h.css({opacity:1})},2500)})}var m={allowScriptAccess:"always",wmode:"transparent",allowFullScreen:"true"};var n={id:c};e.movieURL=b.attr("href")?b.attr("href").match(/[\\?&]v=([^&#]*)/)[1]:false;swfobject.embedSWF("http://www.youtube.com/apiplayer?enablejsapi=1&version=3&playerapiid="+c,c,e.width,e.height,"8",null,null,m,n);var o={};d.get(0).defaults=a.extend(o,e)})})},setMovie:function(){var b=a(this).get(0);b.onVideoLoaded=undefined;var c=a("#"+b.id+"_data").data();var d=typeof document.YTPBG!="undefined";var e=c.movieURL;a(b).css({opacity:c.opacity});var f=c.ID?"absolute":"fixed";var g=c.bufferImg?a("<div/>").addClass("mbYTP_bufferImg").css({position:f,top:0,left:0,width:"100%",height:"100%",background:"url("+c.bufferImg+")"}).hide():false;var h=a(b).parents("div:first");var i=a("<div/>").addClass("mbYTP_raster").css({opacity:0,position:f,top:0,left:0,width:"100%",height:"100%",background:"url("+a.mbYTPlayer.rasterImg+")"});if(c.bufferImg)a(h).after(g);if(c.isBgndMovie&&!d){if(c.addRaster&&a.mbYTPlayer.rasterImg&&a(".mbYTP_raster").length==0){a(h).append(i)}if(!c.ID)document.YTPBG=true;if(e)if(c.autoplay)b.loadVideoByUrl("http://www.youtube.com/v/"+e,0);else b.cueVideoByUrl("http://www.youtube.com/v/"+e,0);if(c.isBgndMovie.mute)b.mute();if(c.showControls)a(b).buildYTPControls()}else{b.cueVideoByUrl("http://www.youtube.com/v/"+e,0);a(b).buildYTPControls()}b.setPlaybackQuality(c.quality);setInterval(function(){playerState(b.getPlayerState(),b.id)},1e3)},changeMovie:function(b,c){var d=a(this).get(0);var e=a("#"+d.id+"_data").data();if(c){a.extend(e,c)}else{var f=a("#"+d.id+"_data").get(0).defaults;a.extend(e,f)}e.movieURL=b.match(/[\\?&]v=([^&#]*)/)[1];d.loadVideoByUrl("http://www.youtube.com/v/"+e.movieURL,0);a(d).optimizeDisplay()},getPlayer:function(){return this.get(0)},playYTP:function(){var b=a(this).get(0);var c=a("#"+b.id+"_data").data();var d=c.ID?a(b).parent().parent():a(b).parent();var e=d.find(".mb_YTVPPlaypause");e.html(a.mbYTPlayer.controls.pause);b.playVideo()},stopYTP:function(){var b=a(this).get(0);var c=a("#"+b.id+"_data").data();var d=c.ID?a(b).parent().parent():a(b).parent();var e=d.find(".mb_YTVPPlaypause");e.html(a.mbYTPlayer.controls.play);b.pauseVideo()},pauseYTP:function(){var b=a(this).get(0);var c=a("#"+b.id+"_data").data();var d=c.ID?a(b).parent().parent():a(b).parent();var e=d.find(".mb_YTVPPlaypause");e.html(a.mbYTPlayer.controls.play);b.pauseVideo()},setYTPVolume:function(b){var c=a(this).get(0);var d=a("#"+c.id+"_data").data();if(!b&&!d.vol&&c.getVolume()==0)d.vol=100;else if(!b&&c.getVolume()>0||b&&c.getVolume()==b)d.vol=0;else d.vol=b;c.setVolume(d.vol)},muteYTPVolume:function(){var b=a(this).get(0);var c=a("#"+b.id+"_data").data();var d=c.ID?a(b).parent().parent():a(b).parent();var e=d.find(".mb_YTVPMuteUnmute");e.html(a.mbYTPlayer.controls.unmute);b.mute()},unmuteYTPVolume:function(){var b=a(this).get(0);var c=a("#"+b.id+"_data").data();var d=c.ID?a(b).parent().parent():a(b).parent();var e=d.find(".mb_YTVPMuteUnmute");e.html(a.mbYTPlayer.controls.mute);b.unMute()},manageYTPProgress:function(){var b=a(this).get(0);var c=a("#"+b.id+"_data").data();var d=c.ID?a(b).parent().parent():a(b).parent();var e=d.find(".mb_YTVPProgress");var f=d.find(".mb_YTVPLoaded");var g=d.find(".mb_YTVTime");var h=e.outerWidth();var i=b.getVideoStartBytes();var j=b.getVideoBytesTotal();var k=b.getVideoBytesLoaded();var l=Math.floor(b.getCurrentTime());var m=Math.floor(b.getDuration());var n=l*h/m;var o=0;if(i){o=b.timeW}var p=k*(h-o)/j;f.css({left:o,width:p});g.css({left:0,width:n});return{totalTime:m,currentTime:l}},buildYTPControls:function(){var b=a(this).get(0);var c=a("#"+b.id+"_data").data();if(typeof b.isInit!="undefined")return;b.isInit=true;var d=a(this).parent();var e=a("<span/>").addClass("mb_YTVPBar").css({whiteSpace:"noWrap",position:c.isBgndMovie&&!c.ID?"fixed":"absolute"}).hide();var f=a("<div/>").addClass("buttonBar");var g=a("<span>"+a.mbYTPlayer.controls.play+"</span>").addClass("mb_YTVPPlaypause").click(function(){if(b.getPlayerState()==1){a(b).pauseYTP()}else{a(b).playYTP()}});var h=a("<span>"+a.mbYTPlayer.controls.mute+"</span>").addClass("mb_YTVPMuteUnmute").click(function(){if(b.isMuted()){a(b).unmuteYTPVolume()}else{a(b).muteYTPVolume()}});var i=a("<span/>").addClass("mb_YTVPTime");var j=a("<div/>").addClass("mb_YTVPProgress").css("position","absolute").click(function(a){l.css({width:a.clientX-l.offset().left});b.timeW=a.clientX-l.offset().left;d.find(".mb_YTVPLoaded").css({width:0});var c=Math.floor(b.getDuration());b.goto=l.outerWidth()*c/j.outerWidth();b.seekTo(b.goto,true);d.find(".mb_YTVPLoaded").css({width:0})});var k=a("<div/>").addClass("mb_YTVPLoaded").css("position","absolute");var l=a("<div/>").addClass("mb_YTVTime").css("position","absolute");j.append(k).append(l);f.append(g).append(h).append(i);e.append(f).append(j);if(c.ID){d.before(e)}else{d.append(e)}if(!c.isBgndMovie){d.css({opacity:c.opacity});d.hover(function(){e.fadeIn();clearInterval(b.getState);b.getState=setInterval(function(){if(b.isMuted()){d.parent().find(".mb_YTVPMuteUnmute").html(a.mbYTPlayer.controls.unmute)}var c=a(b).manageYTPProgress();a(".mb_YTVPTime").html(a.mbYTPlayer.formatTime(c.currentTime)+" / "+a.mbYTPlayer.formatTime(c.totalTime));if(b.getPlayerState()==1&&a(".mb_YTVPPlaypause").html()!=a.mbYTPlayer.controls.pause)d.parent().find(".mb_YTVPPlaypause").html(a.mbYTPlayer.controls.pause);if(b.getPlayerState()==2)d.parent().find(".mb_YTVPPlaypause").html(a.mbYTPlayer.controls.play)},1e3)},function(){e.fadeOut();clearInterval(b.getState)})}else{e.fadeIn();clearInterval(b.getState);b.getState=setInterval(function(){var c=a(b).manageYTPProgress();if(b.isMuted()){d.parent().find(".mb_YTVPMuteUnmute").html(a.mbYTPlayer.controls.unmute)}d.parent().find(".mb_YTVPTime").html(a.mbYTPlayer.formatTime(c.currentTime)+" / "+a.mbYTPlayer.formatTime(c.totalTime));if(b.getPlayerState()==1&&a(".mb_YTVPPlaypause").html()!=a.mbYTPlayer.controls.pause)d.parent().find(".mb_YTVPPlaypause").html(a.mbYTPlayer.controls.pause);if(b.getPlayerState()==2)d.parent().find(".mb_YTVPPlaypause").html(a.mbYTPlayer.controls.play)},1e3)}},formatTime:function(a){var b=Math.floor(a/60);var c=Math.floor(a-60*b);return(b<9?"0"+b:b)+" : "+(c<9?"0"+c:c)}};a.fn.mb_YTPlayer=a.mbYTPlayer.setYTPlayer;a.fn.mb_setMovie=a.mbYTPlayer.setMovie;a.fn.changeMovie=a.mbYTPlayer.changeMovie;a.fn.getPlayer=a.mbYTPlayer.getPlayer;a.fn.buildYTPControls=a.mbYTPlayer.buildYTPControls;a.fn.playYTP=a.mbYTPlayer.playYTP;a.fn.stopYTP=a.mbYTPlayer.stopYTP;a.fn.pauseYTP=a.mbYTPlayer.pauseYTP;a.fn.muteYTPVolume=a.mbYTPlayer.muteYTPVolume;a.fn.unmuteYTPVolume=a.mbYTPlayer.unmuteYTPVolume;a.fn.setYTPVolume=a.mbYTPlayer.setYTPVolume;a.fn.manageYTPProgress=a.mbYTPlayer.manageYTPProgress})(jQuery);jQuery.fn.toggleVideoState=function(){var a=this.get(0);var b=a.isInit;if(b=="undefined")this.mb_YTPlayer();else if(a.getPlayerState()==1)a.pauseVideo();else a.playVideo()};jQuery.fn.optimizeDisplay=function(){var a=this.get(0);var b=jQuery("#"+a.id+"_data").data();var c=jQuery("#wrapper_"+a.id);var d=b.lightCrop;var e={};var f=b.ID?jQuery("#"+b.ID):jQuery(window);e.width=f.width();e.height=f.height();var g={};g.width=e.width+(d?e.width*20/100:0);g.height=b.ratio=="16/9"?Math.ceil(9*e.width/16):Math.ceil(3*e.width/4);var h=-((g.height-e.height)/2);var i=-(d?e.width*10/100:0);if(g.height<e.height){g.height=e.height+(d?e.height*20/100:0);g.width=b.ratio=="16/9"?Math.ceil(16*e.height/9):Math.ceil(4*e.height/3);h=-(d?e.height*10/100:0);i=-((g.width-e.width)/2)}c.css({width:g.width,height:g.height,marginTop:h,marginLeft:i})}